.mode csv

.header on


-------------------
-- ORACLE PARAMS --
-------------------
.out "oracle_params.csv"

SELECT
  scenarios.id                   as  scenario,
  width                          as  data_width,
  height                         as  data_height,
  tin                            as  data_tin,
  tout                           as  data_tout,
  north                          as  kern_north,
  south                          as  kern_south,
  east                           as  kern_east,
  west                           as  kern_west,
  instruction_count              as  kern_instruction_count,
  ratio_AShr_insts               as  kern_ratio_AShr_insts,
  ratio_Add_insts                as  kern_ratio_Add_insts,
  ratio_Alloca_insts             as  kern_ratio_Alloca_insts,
  ratio_And_insts                as  kern_ratio_And_insts,
  ratio_Br_insts                 as  kern_ratio_Br_insts,
  ratio_Call_insts               as  kern_ratio_Call_insts,
  ratio_FAdd_insts               as  kern_ratio_FAdd_insts,
  ratio_FCmp_insts               as  kern_ratio_FCmp_insts,
  ratio_FDiv_insts               as  kern_ratio_FDiv_insts,
  ratio_FMul_insts               as  kern_ratio_FMul_insts,
  ratio_FPExt_insts              as  kern_ratio_FPExt_insts,
  ratio_FPToSI_insts             as  kern_ratio_FPToSI_insts,
  ratio_FSub_insts               as  kern_ratio_FSub_insts,
  ratio_GetElementPtr_insts      as  kern_ratio_GetElementPtr_insts,
  ratio_ICmp_insts               as  kern_ratio_ICmp_insts,
  ratio_InsertValue_insts        as  kern_ratio_InsertValue_insts,
  ratio_Load_insts               as  kern_ratio_Load_insts,
  ratio_Mul_insts                as  kern_ratio_Mul_insts,
  ratio_Or_insts                 as  kern_ratio_Or_insts,
  ratio_PHI_insts                as  kern_ratio_PHI_insts,
  ratio_Ret_insts                as  kern_ratio_Ret_insts,
  ratio_SDiv_insts               as  kern_ratio_SDiv_insts,
  ratio_SExt_insts               as  kern_ratio_SExt_insts,
  ratio_SIToFP_insts             as  kern_ratio_SIToFP_insts,
  ratio_SRem_insts               as  kern_ratio_SRem_insts,
  ratio_Select_insts             as  kern_ratio_Select_insts,
  ratio_Shl_insts                as  kern_ratio_Shl_insts,
  ratio_Store_insts              as  kern_ratio_Store_insts,
  ratio_Sub_insts                as  kern_ratio_Sub_insts,
  ratio_Trunc_insts              as  kern_ratio_Trunc_insts,
  ratio_UDiv_insts               as  kern_ratio_UDiv_insts,
  ratio_Xor_insts                as  kern_ratio_Xor_insts,
  ratio_ZExt_insts               as  kern_ratio_ZExt_insts,
  ratio_basic_blocks             as  kern_ratio_basic_blocks,
  ratio_memory_instructions      as  kern_ratio_memory_instructions,
  ratio_non_external_functions   as  kern_ratio_non_external_functions,
  max_wg_size                    as  kern_max_wg_size,
  count                          as  dev_count,
  address_bits                   as  dev_address_bits,
  double_fp_config               as  dev_double_fp_config,
  endian_little                  as  dev_endian_little,
  execution_capabilities         as  dev_execution_capabilities,
  extensions                     as  dev_extensions,
  global_mem_cache_size          as  dev_global_mem_cache_size,
  global_mem_cache_type          as  dev_global_mem_cache_type,
  global_mem_cacheline_size      as  dev_global_mem_cacheline_size,
  global_mem_size                as  dev_global_mem_size,
  host_unified_memory            as  dev_host_unified_memory,
  image2d_max_height             as  dev_image2d_max_height,
  image2d_max_width              as  dev_image2d_max_width,
  image3d_max_depth              as  dev_image3d_max_depth,
  image3d_max_height             as  dev_image3d_max_height,
  image3d_max_width              as  dev_image3d_max_width,
  image_support                  as  dev_image_support,
  local_mem_size                 as  dev_local_mem_size,
  local_mem_type                 as  dev_local_mem_type,
  max_clock_frequency            as  dev_max_clock_frequency,
  max_compute_units              as  dev_max_compute_units,
  max_constant_args              as  dev_max_constant_args,
  max_constant_buffer_size       as  dev_max_constant_buffer_size,
  max_mem_alloc_size             as  dev_max_mem_alloc_size,
  max_parameter_size             as  dev_max_parameter_size,
  max_read_image_args            as  dev_max_read_image_args,
  max_samplers                   as  dev_max_samplers,
  max_work_group_size            as  dev_max_work_group_size,
  max_work_item_dimensions       as  dev_max_work_item_dimensions,
  max_work_item_sizes_0          as  dev_max_work_item_sizes_0,
  max_work_item_sizes_1          as  dev_max_work_item_sizes_1,
  max_work_item_sizes_2          as  dev_max_work_item_sizes_2,
  max_write_image_args           as  dev_max_write_image_args,
  mem_base_addr_align            as  dev_mem_base_addr_align,
  min_data_type_align_size       as  dev_min_data_type_align_size,
  native_vector_width_char       as  dev_native_vector_width_char,
  native_vector_width_double     as  dev_native_vector_width_double,
  native_vector_width_float      as  dev_native_vector_width_float,
  native_vector_width_half       as  dev_native_vector_width_half,
  native_vector_width_int        as  dev_native_vector_width_int,
  native_vector_width_long       as  dev_native_vector_width_long,
  native_vector_width_short      as  dev_native_vector_width_short,
  preferred_vector_width_char    as  dev_preferred_vector_width_char,
  preferred_vector_width_double  as  dev_preferred_vector_width_double,
  preferred_vector_width_float   as  dev_preferred_vector_width_float,
  preferred_vector_width_half    as  dev_preferred_vector_width_half,
  preferred_vector_width_int     as  dev_preferred_vector_width_int,
  preferred_vector_width_long    as  dev_preferred_vector_width_long,
  preferred_vector_width_short   as  dev_preferred_vector_width_short,
  queue_properties               as  dev_queue_properties,
  single_fp_config               as  dev_single_fp_config,
  type                           as  dev_type,
  vendor                         as  dev_vendor,
  vendor_id                      as  dev_vendor_id,
  version                        as  dev_version,
  params                         as  wgsize
FROM oracle_params
LEFT JOIN scenarios
    ON oracle_params.scenario=scenarios.id
LEFT JOIN datasets
    ON scenarios.dataset=datasets.id
LEFT JOIN kernels
    ON scenarios.kernel=kernels.id
LEFT JOIN devices
    ON scenarios.device=devices.id;


-------------------
-- RUNTIME STATS --
-------------------
.out "runtime_stats.csv"

SELECT
  scenarios.id                   as  scenario,
  width                          as  data_width,
  height                         as  data_height,
  tin                            as  data_tin,
  tout                           as  data_tout,
  north                          as  kern_north,
  south                          as  kern_south,
  east                           as  kern_east,
  west                           as  kern_west,
  instruction_count              as  kern_instruction_count,
  ratio_AShr_insts               as  kern_ratio_AShr_insts,
  ratio_Add_insts                as  kern_ratio_Add_insts,
  ratio_Alloca_insts             as  kern_ratio_Alloca_insts,
  ratio_And_insts                as  kern_ratio_And_insts,
  ratio_Br_insts                 as  kern_ratio_Br_insts,
  ratio_Call_insts               as  kern_ratio_Call_insts,
  ratio_FAdd_insts               as  kern_ratio_FAdd_insts,
  ratio_FCmp_insts               as  kern_ratio_FCmp_insts,
  ratio_FDiv_insts               as  kern_ratio_FDiv_insts,
  ratio_FMul_insts               as  kern_ratio_FMul_insts,
  ratio_FPExt_insts              as  kern_ratio_FPExt_insts,
  ratio_FPToSI_insts             as  kern_ratio_FPToSI_insts,
  ratio_FSub_insts               as  kern_ratio_FSub_insts,
  ratio_GetElementPtr_insts      as  kern_ratio_GetElementPtr_insts,
  ratio_ICmp_insts               as  kern_ratio_ICmp_insts,
  ratio_InsertValue_insts        as  kern_ratio_InsertValue_insts,
  ratio_Load_insts               as  kern_ratio_Load_insts,
  ratio_Mul_insts                as  kern_ratio_Mul_insts,
  ratio_Or_insts                 as  kern_ratio_Or_insts,
  ratio_PHI_insts                as  kern_ratio_PHI_insts,
  ratio_Ret_insts                as  kern_ratio_Ret_insts,
  ratio_SDiv_insts               as  kern_ratio_SDiv_insts,
  ratio_SExt_insts               as  kern_ratio_SExt_insts,
  ratio_SIToFP_insts             as  kern_ratio_SIToFP_insts,
  ratio_SRem_insts               as  kern_ratio_SRem_insts,
  ratio_Select_insts             as  kern_ratio_Select_insts,
  ratio_Shl_insts                as  kern_ratio_Shl_insts,
  ratio_Store_insts              as  kern_ratio_Store_insts,
  ratio_Sub_insts                as  kern_ratio_Sub_insts,
  ratio_Trunc_insts              as  kern_ratio_Trunc_insts,
  ratio_UDiv_insts               as  kern_ratio_UDiv_insts,
  ratio_Xor_insts                as  kern_ratio_Xor_insts,
  ratio_ZExt_insts               as  kern_ratio_ZExt_insts,
  ratio_basic_blocks             as  kern_ratio_basic_blocks,
  ratio_memory_instructions      as  kern_ratio_memory_instructions,
  ratio_non_external_functions   as  kern_ratio_non_external_functions,
  max_wg_size                    as  kern_max_wg_size,
  -- count                          as  dev_count,
  -- address_bits                   as  dev_address_bits,
  -- double_fp_config               as  dev_double_fp_config,
  -- endian_little                  as  dev_endian_little,
  -- execution_capabilities         as  dev_execution_capabilities,
  -- extensions                     as  dev_extensions,
  global_mem_cache_size          as  dev_global_mem_cache_size,
  global_mem_cache_type          as  dev_global_mem_cache_type,
  global_mem_cacheline_size      as  dev_global_mem_cacheline_size,
  global_mem_size                as  dev_global_mem_size,
  host_unified_memory            as  dev_host_unified_memory,
  -- image2d_max_height             as  dev_image2d_max_height,
  -- image2d_max_width              as  dev_image2d_max_width,
  -- image3d_max_depth              as  dev_image3d_max_depth,
  -- image3d_max_height             as  dev_image3d_max_height,
  -- image3d_max_width              as  dev_image3d_max_width,
  -- image_support                  as  dev_image_support,
  local_mem_size                 as  dev_local_mem_size,
  local_mem_type                 as  dev_local_mem_type,
  -- max_clock_frequency            as  dev_max_clock_frequency,
  max_compute_units              as  dev_max_compute_units,
  -- max_constant_args              as  dev_max_constant_args,
  -- max_constant_buffer_size       as  dev_max_constant_buffer_size,
  -- max_mem_alloc_size             as  dev_max_mem_alloc_size,
  -- max_parameter_size             as  dev_max_parameter_size,
  -- max_read_image_args            as  dev_max_read_image_args,
  -- max_samplers                   as  dev_max_samplers,
  -- max_work_group_size            as  dev_max_work_group_size,
  -- max_work_item_dimensions       as  dev_max_work_item_dimensions,
  -- max_work_item_sizes_0          as  dev_max_work_item_sizes_0,
  -- max_work_item_sizes_1          as  dev_max_work_item_sizes_1,
  -- max_work_item_sizes_2          as  dev_max_work_item_sizes_2,
  -- max_write_image_args           as  dev_max_write_image_args,
  -- mem_base_addr_align            as  dev_mem_base_addr_align,
  -- min_data_type_align_size       as  dev_min_data_type_align_size,
  -- native_vector_width_char       as  dev_native_vector_width_char,
  -- native_vector_width_double     as  dev_native_vector_width_double,
  -- native_vector_width_float      as  dev_native_vector_width_float,
  -- native_vector_width_half       as  dev_native_vector_width_half,
  -- native_vector_width_int        as  dev_native_vector_width_int,
  -- native_vector_width_long       as  dev_native_vector_width_long,
  -- native_vector_width_short      as  dev_native_vector_width_short,
  -- preferred_vector_width_char    as  dev_preferred_vector_width_char,
  -- preferred_vector_width_double  as  dev_preferred_vector_width_double,
  -- preferred_vector_width_float   as  dev_preferred_vector_width_float,
  -- preferred_vector_width_half    as  dev_preferred_vector_width_half,
  -- preferred_vector_width_int     as  dev_preferred_vector_width_int,
  -- preferred_vector_width_long    as  dev_preferred_vector_width_long,
  -- preferred_vector_width_short   as  dev_preferred_vector_width_short,
  -- queue_properties               as  dev_queue_properties,
  -- single_fp_config               as  dev_single_fp_config,
  type                           as  dev_type,
  vendor                         as  dev_vendor,
  -- vendor_id                      as  dev_vendor_id,
  -- version                        as  dev_version,
  params.wg_c                    as  wg_c,
  params.wg_r                    as  wg_r,
  mean                           as  runtime
FROM runtime_stats
LEFT JOIN scenarios
  ON runtime_stats.scenario=scenarios.id
LEFT JOIN params
  ON runtime_stats.params=params.id
LEFT JOIN datasets
  ON scenarios.dataset=datasets.id
LEFT JOIN kernels
  ON scenarios.kernel=kernels.id
LEFT JOIN devices
  ON scenarios.device=devices.id
ORDER BY RANDOM()
LIMIT 50000;
